# State Entities - Current system state

type Project {
  id: ID!
  projectId: BigInt!
  address: String!
  name: String!
  description: String!
  projectLead: String!
  payrollManager: String!
  paymentToken: String!
  creator: String!
  createdAt: BigInt!
  lastUpdated: BigInt!
  # Current totals
  totalPUnits: BigInt!
  totalDUnits: BigInt!
  totalCUnits: BigInt!
  totalFunding: BigInt!
  # Reference to current settings
  currentSettings: ProjectSettings!
  # Relationships
  contributors: [Contributor!]! @derivedFrom(field: "project")
  contributions: [Contribution!]! @derivedFrom(field: "project")
  settings: [ProjectSettings!]! @derivedFrom(field: "project")
  events: [ProjectEvent!]! @derivedFrom(field: "project")
}

type ProjectSettings {
  id: ID!
  project: Project!
  # Configuration values
  pToDMultiplier: BigInt!
  pToCMultiplier: BigInt!
  dToCMultiplier: BigInt!
  pUnitCapacity: BigInt!
  dUnitCapacity: BigInt!
  cUnitCapacity: BigInt!
  # Metadata
  effectiveFrom: BigInt!
  createdAt: BigInt!
  updatedBy: String!
}

type Contributor {
  id: ID!
  project: Project!
  address: String!
  # Current status
  isWhitelisted: Boolean!
  whitelistedAt: BigInt
  removedAt: BigInt
  # Current unit totals
  totalPUnits: BigInt!
  totalDUnits: BigInt!
  totalCUnits: BigInt!
  # Metadata
  lastUpdated: BigInt!
  # Relationships
  contributions: [Contribution!]! @derivedFrom(field: "contributor")
  events: [ContributorEvent!]! @derivedFrom(field: "contributor")
}

type Contribution {
  id: ID!
  project: Project!
  contributor: Contributor!
  contributionId: BigInt!
  # Contribution details
  unitType: BigInt!
  unitsRequested: BigInt!
  unitsAwarded: BigInt!
  description: String!
  # Current status
  status: String! # "pending", "approved", "rejected"
  # Timestamps
  submittedAt: BigInt!
  processedAt: BigInt
  lastUpdated: BigInt!
  # Relationships
  events: [ContributionEvent!]! @derivedFrom(field: "contribution")
}

# Event Entities - Immutable audit trail

type ContributionEvent {
  id: ID!
  project: Project!
  contribution: Contribution!
  contributionId: BigInt!
  eventType: String! # "submitted", "approved", "rejected"
  contributor: String!
  executor: String!
  # Event-specific data
  unitType: BigInt
  unitsRequested: BigInt
  unitsAwarded: BigInt
  description: String
  # Blockchain metadata
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: String!
}

type ContributorEvent {
  id: ID!
  project: Project!
  contributor: Contributor!
  contributorAddress: String!
  eventType: String! # "whitelisted", "removed"
  executor: String!
  # Blockchain metadata
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: String!
}

type ProjectEvent {
  id: ID!
  project: Project!
  eventType: String! # "initialized", "lead_updated", "manager_updated", "multipliers_updated", "capacity_updated", "funded", "units_distributed", "units_converted"
  executor: String!
  # Event-specific data as JSON string for flexibility
  eventData: String!
  # Blockchain metadata
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: String!
}

# Factory Event Entities - Keep these for factory audit trail

type PiePayFactory_ProjectCreated {
  id: ID!
  projectId: BigInt!
  projectAddress: String!
  projectName: String!
  projectDescription: String!
  projectLead: String!
  payrollManager: String!
  paymentToken: String!
  creator: String!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
}

type PiePayFactory_ProjectMetadataUpdated {
  id: ID!
  projectId: BigInt!
  projectAddress: String!
  updatedBy: String!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
}

